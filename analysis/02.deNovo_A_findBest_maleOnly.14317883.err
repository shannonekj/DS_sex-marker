
##  VARIABLES  ##
# directories
script_dir="/home/sejoslin/git_repos/DS_sex-marker/scripts"
data_dir="/home/sejoslin/projects/sexMarker/data"
out_dir="${data_dir}/RAD_deNovo_maleOnly"

# other
prefix="SexMarker"
n="4"


##  RUN  ##
bash ${script_dir}/findBestInd.sh ${data_dir} ${out_dir} ${prefix} ${n} 


###############
###  SETUP  ###
###############

echo "Setting up variables"

# external
DATA_dir=$1     # directory where raw split fastq files are located
OUT_dir=$2	# directory to direct output to
PREFIX=$3	# Prefix of project
N=$4		# number of individuals to select

# internal 
sum_file="${OUT_dir}/${PREFIX}_line_count.all"

###################
###  DO THINGS  ###
###################

mkdir -p ${OUT_dir}
touch ${sum_file}
cd ${DATA_dir}

for i in BMAG0??
do
	cd ${i}
	echo "Entering:" ${i}
	echo "Finding line counts in:"
	for library in 04_split_wells.${i}.??????.sh # MAKE SURE FORMAT IS THE SAME
	do
		index=$(echo ${library} | cut -d. -f3)
		echo "    ${index}"
		cd ${index}
		wc -l *R1.fastq >> ${sum_file}
		cd ../
	done
	cd ../
done

sort -n -r ${sum_file} > ${sum_file}.sorted


# grab the best
n=$(( $N + 1 ))
head -${n} ${sum_file}.sorted >> ${sum_file}.best
sed -i '1d' ${sum_file}.best

# make best file with only males
cd ${out_dir}
grep _M_ SexMarker_line_count.all.sorted >> SexMarker_line_count.maleOnly.sorted
x=$(( $n + 1 ))
head -${x} SexMarker_line_count.maleOnly.sorted >> SexMarker_line_count.maleOnly.best
sed -i '1d' SexMarker_line_count.maleOnly.best
